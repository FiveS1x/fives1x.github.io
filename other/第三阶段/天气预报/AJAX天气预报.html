<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      .main {
        width: 1500px;
        height: 515px;
        border: 6px solid skyblue;
        border-radius: 10px;
        margin: 50px auto;
      }

      h1 {
        text-align: center;
        font-size: 40px;
        margin-top: 50px;
      }

      .search {
        margin-top: 50px;
        display: flex;
        justify-content: center;
      }

      .search input {
        padding: 10px;
        width: 505px;
        height: 42px;
        outline: none;
        border: 2px solid skyblue;
        box-sizing: border-box;
        font-size: 18px;
      }

      .search button {
        width: 103px;
        height: 42px;
        background-color: skyblue;
        border: 2px solid skyblue;
        color: white;
        font-size: 18px;
        cursor: pointer;
        outline: none;
      }

      .popCity {
        margin: 0 auto;
        margin-top: 20px;
        display: flex;
        justify-content: space-between;
        width: 600px;
      }

      .popCity b {
        font-weight: normal;
      }

      .popCity .cityList {
        display: flex;
        width: 430px;
        justify-content: space-between;
      }

      .popCity .cityList div {
        cursor: pointer;
        color: gray;
      }

      .popCity div.change {
        color: black;
        cursor: pointer;
        display: flex;
        align-items: center;
      }

      .popCity div.change img {
        height: 16px;
        display: block;
      }

      .allWeather {
        margin-top: 60px;
        display: flex;
      }
      .weather {
        flex: 1;
        text-align: center;
        border-right: 1px solid #f0f0f0;
      }

      .weather:hover {
        background-color: #f3f9fe;
        cursor: pointer;
      }

      .weather:last-child {
        border: 0;
      }

      .weather img {
        display: block;
        margin: 0 auto;
        margin-bottom: 8px;
        height: 50px;
      }

      .weather div {
        font-size: 14px;
        margin-bottom: 3px;
      }

      .weather div:nth-child(-n + 3) {
        color: orange;
      }

      .weather div:nth-child(4) {
        color: #abaaaa;
      }

      .error {
        margin-top: 28px;
        text-align: center;
        flex: 1;
        font-size: 30px;
      }
    </style>
  </head>
  <body>
    <div class="main">
      <h1>å¤©æ°”é¢„æŠ¥</h1>
      <div class="search"><input type="text" /><button>æœç´¢</button></div>
      <div class="popCity">
        <b>çƒ­é—¨åŸå¸‚:</b>
        <div class="cityList">
          <!-- <div>å¹¿å·</div>
          <div>å¹¿å·</div>
          <div>å¹¿å·</div>
          <div>å¹¿å·</div>
          <div>å¹¿å·</div>
          <div>å¹¿å·</div>
          <div>å¹¿å·</div> -->
        </div>
        <div class="change">
          <span>æ¢ä¸€æ¢</span><img src="./images/refresh-icon.png" alt="" />
        </div>
      </div>

      <div class="allWeather">
        <!-- <div class="weather">
          <img src="./images/leizhenyu.png" alt="" />
          <div>é›·é˜µé›¨</div>
          <div>æœ€ä½æ¸© 25â„ƒ - æœ€é«˜æ¸© 33â„ƒ</div>
          <div>2021-06-09æ˜ŸæœŸä¸‰</div>
          <div>åŒ—é£</div>
          <div>1-2çº§</div>
        </div>
        <div class="weather">
          <img src="./images/leizhenyu.png" alt="" />
          <div>é›·é˜µé›¨</div>
          <div>æœ€ä½æ¸© 25â„ƒ - æœ€é«˜æ¸© 33â„ƒ</div>
          <div>2021-06-09æ˜ŸæœŸä¸‰</div>
          <div>åŒ—é£</div>
          <div>1-2çº§</div>
        </div>
        <div class="weather">
          <img src="./images/leizhenyu.png" alt="" />
          <div>é›·é˜µé›¨</div>
          <div>æœ€ä½æ¸© 25â„ƒ - æœ€é«˜æ¸© 33â„ƒ</div>
          <div>2021-06-09æ˜ŸæœŸä¸‰</div>
          <div>åŒ—é£</div>
          <div>1-2çº§</div>
        </div>
        <div class="weather">
          <img src="./images/leizhenyu.png" alt="" />
          <div>é›·é˜µé›¨</div>
          <div>æœ€ä½æ¸© 25â„ƒ - æœ€é«˜æ¸© 33â„ƒ</div>
          <div>2021-06-09æ˜ŸæœŸä¸‰</div>
          <div>åŒ—é£</div>
          <div>1-2çº§</div>
        </div>
        <div class="weather">
          <img src="./images/leizhenyu.png" alt="" />
          <div>é›·é˜µé›¨</div>
          <div>æœ€ä½æ¸© 25â„ƒ - æœ€é«˜æ¸© 33â„ƒ</div>
          <div>2021-06-09æ˜ŸæœŸä¸‰</div>
          <div>åŒ—é£</div>
          <div>1-2çº§</div>
        </div>
        <div class="weather">
          <img src="./images/leizhenyu.png" alt="" />
          <div>é›·é˜µé›¨</div>
          <div>æœ€ä½æ¸© 25â„ƒ - æœ€é«˜æ¸© 33â„ƒ</div>
          <div>2021-06-09æ˜ŸæœŸä¸‰</div>
          <div>åŒ—é£</div>
          <div>1-2çº§</div>
        </div>
        <div class="weather">
          <img src="./images/leizhenyu.png" alt="" />
          <div>é›·é˜µé›¨</div>
          <div>æœ€ä½æ¸© 25â„ƒ - æœ€é«˜æ¸© 33â„ƒ</div>
          <div>2021-06-09æ˜ŸæœŸä¸‰</div>
          <div>åŒ—é£</div>
          <div>1-2çº§</div>
        </div> -->
      </div>
    </div>
  </body>
  <script src="./js/jquery.min.js"></script>
  <script>
    // çƒ­é—¨åŸå¸‚æ€»åˆ—è¡¨
    var arrCityName = [
      "åŒ—äº¬",
      "ä¸Šæµ·",
      "å¹¿å·",
      "æ·±åœ³",
      "è‹å·",
      "å¤§è¿",
      "é‡åº†",
      "æ­å·",
      "æ— é”¡",
      "å¤©æ´¥",
      "ä½›å±±",
      "å®æ³¢",
      "å—äº¬",
      "æˆéƒ½",
      "ä¸œè",
      "æ­¦æ±‰",
      "é’å²›",
      "æ²ˆé˜³",
      "çƒŸå°",
      "å”å±±",
      "æµå—",
      "å“ˆå°”æ»¨",
      "çŸ³å®¶åº„",
      "éƒ‘å·",
      "æ³‰å·",
      "æ¸©å·",
      "é•¿æ²™",
      "å—é€š",
      "é•¿æ˜¥",
      "æ½åŠ",
      "ç»å…´",
      "ç¦å·",
      "æ·„åš",
      "å¤§åº†",
      "å¸¸å·",
      "å°å·",
      "æµå®",
      "ä¸œè¥",
      "è¥¿å®‰",
      "å¾å·",
      "ä¸´æ²‚",
      "å¨æµ·",
      "å˜‰å…´",
      "é‚¯éƒ¸",
      "æ´›é˜³",
      "æ²§å·",
      "é‡‘å",
      "æ˜†æ˜",
      "å—é˜³",
      "ä¿å®š",
    ];

    // åˆ›å»ºajaxå¯¹è±¡
    var xhr = new XMLHttpRequest();

    function hotCityFn() {
      var hotCity = [];
      var tempArr = [];
      // ç”¨éšæœºæ•°æŠ½ä¸ƒä¸ªæ­¤æ—¶æ”¾è¿›æ–°æ•°ç»„ å½“é•¿åº¦ä¸º7æ—¶åœæ­¢

      while (hotCity.length != 7) {
        // éšæœºæ•°
        var randomX = Math.floor(Math.random() * arrCityName.length);
        if (!hotCity.includes(arrCityName[randomX])) {
          hotCity.push(arrCityName[randomX]);
          tempArr.push("<div>" + arrCityName[randomX] + "</div>");
        }
      }
      var cityList = hotCity.join("");
      $(".cityList").html(tempArr);
      $(".cityList")
        .children()
        .click(function () {
          $("input").val($(this).text());
          getWeather();
        });
      $("input").val(hotCity[0]);
    }

    function getWeather() {
      if ($("input").val() == "") {
        alert("èƒ½ä¸èƒ½è¾“å…¥åŸå¸‚ï¼Œæ²¡åŸå¸‚æˆ‘æ€ä¹ˆæ‰¾å•ŠğŸ˜¥ğŸ˜¥ğŸ˜¥ğŸ˜¥ğŸ˜¥");
        return;
      }
      // ä½¿ç”¨ajax
      xhr.open(
        "GET",
        "https://apis.tianapi.com/tianqi/index?key=63d033e7824e2dd2a9b657540fcc6163&type=7&city=" +
          $("input").val()
      );
      xhr.send();
      xhr.onreadystatechange = function () {
        if (xhr.readyState == 4 && xhr.status == 200) {
          var res = JSON.parse(xhr.responseText);
          if (res.code == 200) {
            res = res.result;
            var weatherList = res.list;

            // æ¸…ç©ºallweatherçš„å­©å­
            $(".allWeather").children().remove();
            for (var i in weatherList) {
              var newDiv = $("<div></div>");
              var str = "";
              newDiv.addClass("weather");
              str +=
                '<img src="./images/' +
                weatherList[i].weatherimg +
                '" alt="" /><div>' +
                weatherList[i].weather +
                "</div><div>æœ€ä½æ¸© " +
                weatherList[i].lowest +
                " - æœ€é«˜æ¸© " +
                weatherList[i].highest +
                "</div><div>" +
                weatherList[i].date +
                " " +
                weatherList[i].week +
                "</div><div>" +
                weatherList[i].wind +
                "</div><div>" +
                weatherList[i].windsc +
                "</div>";
              newDiv.html(str);
              // console.log(newDiv.html());
              $(".allWeather").append(newDiv);
            }
          } else {
            // å¦‚æœä¸æ˜¯200
            $(".allWeather").children().remove();
            var newDiv = $("<div></div>");
            newDiv.addClass("error");
            newDiv.html("ğŸ˜¥å“å‘€,æŸ¥è¯¢å¤©æ°”å‘ç”Ÿäº†é”™è¯¯,é”™è¯¯åŸå› æ˜¯: " + res.msg);
            $(".allWeather").append(newDiv);
          }
        }
      };
    }

    // å½“ç½‘é¡µåŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡åˆ·æ–°çƒ­é—¨åŸå¸‚
    $(document).on("DOMContentLoaded", function () {
      hotCityFn();
      getWeather();
    });

    // å½“ç‚¹å‡»æ¢ä¸€æ¢æ—¶å°±åˆ·æ–°
    $(".change").click(function () {
      hotCityFn();
      getWeather();
    });

    $("button").click(function () {
      getWeather();
    });

    // å›è½¦
    $("input").on("keyup", function (e) {
      if (e.keyCode == 13) {
        getWeather();
      }
    });
  </script>
</html>
